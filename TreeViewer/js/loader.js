// Loads data from newick file

var LoaderWidget = function(selector, newick) {
    
    var that = this;
    this.selector = selector;
    this.newick = newick;
    this.width = parseInt($(this.selector).css("width"));
    
    // Build widget window
    this.loader_window = $("<div></div>")
                            .addClass("panel panel-default")
                            .attr("id", "loader-widget")
                            .attr('width', this.width)
                            .append("<div class='panel-heading'>")
                            .append("<div class='panel-body' id='loader-body'>");
    
    $(this.selector).append(this.loader_window);                               
    
    // Build the form
    $("#loader-body").append(
                $("<textarea></textarea>")
                    .addClass("form-control")
                    .attr("id", "loader-data")
                    .attr("rows", 4)
        ).append(
                $("<button></button>")
                    .addClass("btn btn-primary")
                    .attr("id", "load-button")
                    .css("float", "left")
                    .text("Load")
        );
        
    this.load_button = "#load-button";
    this.load_form = "loader-data";
};

LoaderWidget.prototype.toJSON = function(newick) {
    // Convert newick string to JSON for loading into D3
    var tree = Newick.parse(newick);
    return tree;
};

LoaderWidget.prototype.on_click = function(loaderwidget) {
    // Handle click from loader widget
    var that = loaderwidget;
    var text = $("#loader-data").val();
    // example newick for testing
    if (!text) {
        //text = "(PITX1_Anole:0.24185,(((PITX2_Anole:0.06605,((PITX2_Human:0.0284,(PITX2_Chicken:0.0306,PITX2_Turtle:0.0306):0.0284):0.0421,(PITX2_Turkey:0.035,PITX2_Duck:0.035):0.0421):0.06605):0.0834,(PITX1_Turtle:0.0911,(PITX1_Chicken:0.0933,PITX1_Human:0.0933):0.0911):0.0834):0.1002,(PITX1_Duck:0.12535,PITX1_Turkey:0.12535):0.1002):0.24185)";
        //text = "(Bovine:0.69395,(Gibbon:0.36079,(Orang:0.33636,(Gorilla:0.17147,(Chimp:0.19268, Human:0.11927):0.08386):0.06124):0.15057):0.54939,Mouse:1.21460):0.10";
        text = "(Bovine:0.69395,(Hylobates:0.36079,(Pongo:0.33636,(G._Gorilla:0.17147, (P._paniscus:0.19268,H._sapiens:0.11927):0.08386):0.06124):0.15057):0.54939, Rodent:1.21460)";
       //text = "(XX00000058:0.06093527,XX00000059:0.07537120,(XX00000056:0.14028420,((XX00000055:0.15160277,XX00000060:0.25267454)5.757736:0.11173700,((XX00000075:1.30804926,XX00000061:0.35952393)1.766348:0.18138217,(((((XX00000069:0.35140669,XX00000106:0.42410523)30.278387:0.36368565,((XX00000105:0.08600641,(XX00000100:0.08638801,XX00000102:0.07031509)11.329040:0.05472515)40.862977:0.28187581,XX00000092:0.25407741)0.547131:0.13030336)13.262233:0.33289124,((XX00000078:0.08876399,(((XX00000073:0.06689567,(XX00000062:0.06376951,XX00000107:0.08506561)0.000000:0.00000080)34.097502:0.05254592,((XX00000071:0.16649296,(XX00000074:0.11700256,XX00000081:0.15104074)44.794127:0.12143065)1.566392:0.01347451,((XX00000066:0.06272255,(XX00000077:0.03060255,XX00000097:0.01502569)36.918192:0.06913115)83.457749:0.11587510,(XX00000064:0.14066813,(XX00000094:0.03141273,(XX00000086:0.22944822,XX00000096:0.20653197)3.577225:0.03794107)11.815337:0.02130922)7.472200:0.01484016)0.654127:0.00585166)12.462959:0.01825827)11.699716:0.02709394,(XX00000070:0.08774123,XX00000082:0.15854749)14.747063:0.04580085)3.388734:0.01574678)8.637606:0.10670698,(XX00000076:0.00549478,XX00000101:0.32547946)4.418744:0.07601640)24.422351:0.44732358)2.499096:0.38263202,(XX00000084:0.74747326,XX00000098:0.74626130)3.412870:0.27184597)81.689746:1.37109205,(XX00000048:0.53561933,(XX00000052:0.14276788,((XX00000016:0.10367988,(XX00000019:0.18449925,(XX00000013:0.05559356,((XX00000014:0.00000274,XX00000015:0.00000001)25.671691:0.11066627,(XX00000000:0.00000696,(XX00000065:0.39212711,XX00000018:0.00337346)0.000000:0.00455766)0.108601:0.00602276)32.383241:0.07698290)69.528190:0.12264230)2.224916:0.01842191)7.029889:0.02146593,(((XX00000039:0.12601271,(XX00000045:0.05537727,(XX00000043:0.00000088,XX00000046:0.01463840)35.494436:0.08371872)32.796517:0.10863217)50.342671:0.16230862,(XX00000030:0.09804068,XX00000038:0.24155903)31.004079:0.11345959)19.785175:0.07248538,(XX00000040:0.26578268,(((XX00000020:0.12059682,XX00000022:0.11939449)22.509257:0.06743953,((XX00000021:0.10221810,XX00000023:0.05377671)6.902693:0.02117717,(XX00000025:0.14655615,XX00000017:0.10722695)1.246967:0.02029164)37.312678:0.06206180)0.496927:0.00840213,((XX00000027:0.12330648,XX00000037:0.10429945)44.121932:0.10070652,(XX00000050:0.10249525,XX00000029:0.23771702)1.331159:0.01687846)3.251403:0.02175192)16.165629:0.04932288)3.799049:0.01771165)4.045990:0.02726957)0.097292:0.01579995)10.063805:0.24882426)18.052371:0.49261067)1.936565:0.14821104)30.850283:0.66974132)2.564631:0.07867980)54.401148:0.17330912)";
        $("#loader-data").attr("placeholder", text);
    }
    return that.toJSON(text);
};

